-- 注意放在最后执行
-- 管理费和销售服务费
DROP TABLE IF EXISTS  statistics_income_manager_saleservice cascade ;
CREATE TABLE statistics_income_manager_saleservice (
	id int4 NULL,
	custno bpchar(10) NULL,
	tradeacco varchar(17) NULL,
	workdate bpchar(8) NULL,
	naturaldate varchar(8) NULL,
	fundid bpchar(6) NULL,
	managementfee numeric NULL,
	saleservicefee numeric NULL,
	partnerno varchar(10) NULL,
	partnernm varchar(32) NULL,
	provider varchar NULL,
	accounttype bpchar(1) NULL,
	fundtp bpchar(1) NULL,
	balance numeric(16,2) NULL,
	nav numeric(7,4) NULL,
	navdt bpchar(8) NULL,
	mktvalue numeric(16,2) NULL
);
CREATE INDEX statistics_income_manager_saleservice_workdate_idx ON statistics_income_manager_saleservice (workdate bpchar_ops) ;
CREATE INDEX statistics_income_manager_saleservice_misc_idx ON statistics_income_manager_saleservice (workdate,partnerno,partnernm,provider,accounttype) ;
CREATE INDEX statistics_income_manager_saleservice_naturaldate_idx ON public.statistics_income_manager_saleservice (naturaldate) ;
create trigger trigger_statistics_income_manager_saleservice before insert
        on statistics_income_manager_saleservice for each row execute procedure OTR_INCOME_MANAGER_SALESERVICE_PARTATION_BY_NATURALDATE();

-- 提前生成好分区表
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170101');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170201');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170301');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170401');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170501');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170601');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170701');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170801');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20170901');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20171001');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20171101');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20171201');

select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180101');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180201');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180301');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180401');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180501');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180601');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180701');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180801');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20180901');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20181001');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20181101');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20181201');

select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190101');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190201');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190301');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190401');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190501');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190601');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190701');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190801');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20190901');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20191001');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20191101');
select F_FULL_INCOME_MANAGER_SALESERVICE_PARTATION('20191201');